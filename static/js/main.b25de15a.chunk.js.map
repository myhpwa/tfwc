{"version":3,"sources":["pages/SettingsPage.tsx","../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","models/Settings.tsx","redux/reducers/setReducer.tsx","models/TmpSettings.tsx","redux/reducers/index.tsx","redux/reducers/tmpSetReducer.tsx","pages/ListPage.tsx","components/ShareTextModal.tsx","models/FreeChargingItem.tsx","models/FreeWifiItem.tsx","App.tsx","redux/store.tsx","serviceWorkerRegistration.ts","index.tsx","Globals.tsx"],"names":["_SettingsPage","props","reportText","state","showBugReportAlert","showFontLicense","dataDownloadRatio","showUpdateDataDone","showClearAlert","showToast","toastMessage","a","this","setState","i","item","Globals","freeResources","downloadCsvZipData","url","progress","length","data","saveFileToIndexedDB","dataKey","className","tabIndex","icon","bug","slot","href","target","checked","hasAppLog","onIonChange","e","isChecked","detail","enableAppLog","disableAppLog","dispatch","type","key","val","hidden","settings","fill","shape","size","onClick","navigator","userAgent","PackageInfos","pwaVersion","JSON","stringify","getLog","cssClass","backdropDismiss","isOpen","header","subHeader","inputs","name","placeholder","buttons","text","handler","value","test","name0","axiosInstance","axios","create","timeout","post","bugReportApiUrl","subject","productName","name1","console","error","role","download","style","flexDirection","textAlign","settingsJsonUri","encodeURIComponent","localStorage","getItem","storeFile","document","createElement","click","remove","id","accept","display","onChange","ev","file","files","fileText","parse","setItem","setImmediate","updateData","Error","stack","getElementById","querySelector","onDidPresent","clearAppData","refreshCircle","width","onDidDismiss","message","duration","colorPalette","appSettings","theme","interface","interfaceOptions","uiFontSize","min","max","pin","snaps","updateCssVars","helpCircle","React","Component","SettingsPage","withIonLifeCycle","connect","speechRate","bookmarks","voiceURI","mainVersion","tmpSettings","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","code","ids","keys","Object","module","exports","Settings","version","isInitialized","updateUi","newSettings","body","classList","toggle","TmpSettings","fetchError","isLoadingData","freeChargingItems","freeWifiItems","currPosition","undefined","shareTextModal","show","combineReducers","action","forEach","defaultSettings","newState","_ListPage","mode","page","rows","selectedMapUrl","dataParts","popover","event","isScrollOn","showConfrimOpenMapAlert","match","params","tab","fetchData","fromStart","ok","fail","timer","setInterval","clearInterval","slice","userCoords","coords","Array","index","mapUrl","latitude","longitude","緯度","經度","push","button","充電站名稱","熱點名稱","地址","getCurrentPositionAndSortData","location","getRows","threshold","disabled","onIonInfinite","complete","loadingText","window","open","ListPage","_ShareTextModal","isAppSettingsExport","appSettingsString","filter","keyVal","join","appUrl","hasQueryString","copyToClipboard","qrcCanvas","qrcode","showModal","swipeToClose","onWillPresent","updateQrCode","finish","height","alignItems","flexGrow","flexShrink","margin","FreeChargingItem","json","主管機關","地區","FreeWifiItem","electronBackendApi","store","savedSettingsStr","createStore","reducer","getSavedStore","setupConfig","swipeBackEnabled","serviceWorkCallbacks","onSuccess","registration","onUpdate","_App","AppOrig","_AppOrig","registrationNew","originalAppSettingsStr","wakeLock","receive","send","isPlatform","oncontextmenu","disableAndroidChromeCallout","ontouchend","disableIosSafariCallout","bind","queryParams","queryString","search","split","setting","showUpdateAlert","showRestoreAppSettingsToast","showGetPositionAlert","speechSynthesis","getVoices","cancel","wakeLockScreen","addEventListener","visibilityState","wakeLockScreenRelease","indexedDB","tfwcDb","onupgradeneeded","result","createObjectStore","log","loadTwdData","getFileFromIndexedDB","d","request","release","routeMatches","exec","queryMatches","route","decodeURIComponent","query","to","pwaUrl","pathname","animated","path","render","exact","routeByQueryString","batteryCharging","wifi","installing","postMessage","waiting","ShareTextModal","restoreAppSettings","App","withRouter","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","serviceWorker","register","onupdatefound","installingWorker","onstatechange","controller","catch","ReactDOM","URL","process","origin","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","progressCallback","downloadData","dataBuffer","zip","AdmZip","dataStr","getEntries","getData","toString","columns","bom","charCodeAt","dl","DownloaderHelper","progressUpdateEnable","on","stats","setTimeout","downloadInfo","removeAllListeners","fs","readFileSync","filePath","start","fileName","dbOpenReq","onsuccess","db","trans","transaction","objectStore","_ev","err","transWrite","reqWrite","put","onerror","delete","clearIndexedDB","clear","getCurrentPosition","geolocation","position","distance","Math","sqrt","postiion","sort","b","consoleLog","consoleError","isMacCatalyst","platform","from","arguments","apply","fetchErrorContent","fontSize","paddingTop","updateApp","getRegistrations","regs","all","reg","update","newReg","hasUpdates","reduce","prev","curr","documentElement","cssText","isTouchDevice","isStoreApps","removeFileFromIndexedDB","removeElementsByClassName","doc","elements","getElementsByClassName","parentNode","removeChild","preventDefault","stopPropagation","s","getSelection","rangeCount","r","getRangeAt","removeAllRanges","addRange","clipboard","writeText"],"mappings":"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","file":"static/js/main.b25de15a.chunk.js","sourcesContent":["import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonRange, IonIcon, IonLabel, IonToggle, IonButton, IonAlert, IonSelect, IonSelectOption, IonToast, withIonLifeCycle, IonProgressBar } from '@ionic/react';\nimport { connect } from 'react-redux';\nimport { RouteComponentProps } from 'react-router-dom';\nimport axios from 'axios';\n\nimport Globals from '../Globals';\nimport { helpCircle, text, refreshCircle, colorPalette, bug, download } from 'ionicons/icons';\nimport './SettingsPage.css';\nimport PackageInfos from '../../package.json';\n\ninterface StateProps {\n  showBugReportAlert: boolean;\n  showFontLicense: boolean;\n  dataDownloadRatio: number;\n  showUpdateDataDone: boolean;\n  showClearAlert: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface Props {\n  dispatch: Function;\n  hasAppLog: boolean;\n  theme: number;\n  uiFontSize: number;\n  settings: any;\n  voiceURI: string;\n  speechRate: number;\n  mainVersion: string | null;\n  cbetaOfflineDbMode: boolean;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass _SettingsPage extends React.Component<PageProps, StateProps> {\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      showBugReportAlert: false,\n      showFontLicense: false,\n      dataDownloadRatio: 0,\n      showUpdateDataDone: false,\n      showClearAlert: false,\n      showToast: false,\n      toastMessage: '',\n    };\n  }\n\n  ionViewWillEnter() {\n  }\n\n  async updateData() {\n    this.setState({ dataDownloadRatio: 0 });\n    for (let i = 0; i < Globals.freeResources.length; i++) {\n      let item = Globals.freeResources[i];\n      const data = await Globals.downloadCsvZipData(item.url, (progress: number) => {\n        this.setState({ dataDownloadRatio: (i + (progress / 100)) / Globals.freeResources.length });\n      });\n      Globals.saveFileToIndexedDB(item.dataKey, data);\n    }\n    this.setState({ dataDownloadRatio: 1, showUpdateDataDone: true });\n  }\n\n  reportText = '';\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'>設定</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonList>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'><a href=\"https://github.com/MrMYHuang/tfwc#report\" target=\"_new\">啟用 app 異常記錄</a></IonLabel>\n              <IonToggle slot='end' checked={this.props.hasAppLog} onIonChange={e => {\n                const isChecked = e.detail.checked;\n\n                if (this.props.hasAppLog === isChecked) {\n                  return;\n                }\n\n                isChecked ? Globals.enableAppLog() : Globals.disableAppLog();\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'hasAppLog',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem hidden={!this.props.settings.hasAppLog}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>回報 app 異常記錄</IonLabel>\n              <IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={e => {\n                this.reportText = \"瀏覽器：\" + navigator.userAgent + \"\\n\\nApp版本：\" + PackageInfos.pwaVersion + \"\\n\\nApp設定：\" + JSON.stringify(this.props.settings) + \"\\n\\nLog：\\n\" + Globals.getLog();\n                this.setState({ showBugReportAlert: true });\n              }}>回報</IonButton>\n              <IonAlert\n                cssClass='uiFont'\n                backdropDismiss={false}\n                isOpen={this.state.showBugReportAlert}\n                header={'異常回報'}\n                subHeader='輸入您的 E-mail，以後續聯絡'\n                inputs={[\n                  {\n                    name: 'name0',\n                    type: 'email',\n                    placeholder: '例：abc@example.com'\n                  },\n                  {\n                    name: 'name1',\n                    type: 'textarea',\n                    placeholder: '請描述發生步驟'\n                  },\n                ]}\n                buttons={[\n                  {\n                    text: '送出',\n                    cssClass: 'primary uiFont',\n                    handler: async (value) => {\n                      if (!/^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/.test(value.name0)) {\n                        this.setState({ showBugReportAlert: false, showToast: true, toastMessage: `錯誤，E-mail 不符格式！` });\n                        return\n                      }\n\n                      try {\n                        const axiosInstance = axios.create({ timeout: 10000 });\n                        await axiosInstance.post(Globals.bugReportApiUrl, {\n                          subject: `${PackageInfos.productName}異常記錄回報`,\n                          text: `E-mail: ${value.name0}\\n\\n發生步驟: ${value.name1}\\n\\n${this.reportText}`,\n                        });\n                        this.setState({ showBugReportAlert: false, showToast: true, toastMessage: `異常回報成功` });\n                      } catch (error) {\n                        console.error(error);\n                        this.setState({ showBugReportAlert: false, showToast: true, toastMessage: `異常回報失敗` });\n                      }\n                    },\n                  },\n                  {\n                    text: '取消',\n                    role: 'cancel',\n                    cssClass: 'secondary uiFont',\n                    handler: () => this.setState({ showBugReportAlert: false }),\n                  },\n                ]}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={download} slot='start' />\n              <div className='contentBlock'>\n                <div style={{ flexDirection: 'column' }}>\n                  <IonLabel className='ion-text-wrap uiFont'>App 設定</IonLabel>\n                  <div style={{ textAlign: 'right' }}>\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={async (e) => {\n                      const settingsJsonUri = `data:text/json;charset=utf-8,${encodeURIComponent(localStorage.getItem(Globals.storeFile) || '')}`;\n                      const a = document.createElement('a');\n                      a.href = settingsJsonUri;\n                      a.download = Globals.storeFile;\n                      a.click();\n                      a.remove();\n                    }}>匯出</IonButton>\n                    <input id='importJsonInput' type='file' accept='.json' style={{ display: 'none' }} onChange={async (ev) => {\n                      const file = ev.target.files?.item(0);\n                      const fileText = await file?.text() || '';\n                      try {\n                        // JSON text validation.\n                        JSON.parse(fileText);\n                        localStorage.setItem(Globals.storeFile, fileText);\n                        this.props.dispatch({ type: 'LOAD_SETTINGS' });\n                        setImmediate(() => {\n                          this.updateData();\n                        });\n                      } catch (e) {\n                        console.error(e);\n                        console.error(new Error().stack);\n                      }\n                      (document.getElementById('importJsonInput') as HTMLInputElement).value = '';\n                    }} />\n\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={(e) => {\n                      (document.querySelector('#importJsonInput') as HTMLInputElement).click();\n                    }}>匯入</IonButton>\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={(e) => {\n                      this.setState({ showClearAlert: true });\n                    }}>重置</IonButton>\n                    <IonAlert\n                      cssClass='uiFont'\n                      isOpen={this.state.showClearAlert}\n                      backdropDismiss={false}\n                      onDidPresent={(ev) => {\n                      }}\n                      header={'重置會還原app設定預設值並清除書籤、離線資料檔！確定重置？'}\n                      buttons={[\n                        {\n                          text: '取消',\n                          cssClass: 'primary uiFont',\n                          handler: (value) => {\n                            this.setState({\n                              showClearAlert: false,\n                            });\n                          },\n                        },\n                        {\n                          text: '重置',\n                          cssClass: 'secondary uiFont',\n                          handler: async (value) => {\n                            await Globals.clearAppData();\n                            this.props.dispatch({ type: 'DEFAULT_SETTINGS' });\n                            this.setState({ showClearAlert: false, showToast: true, toastMessage: \"清除成功!\" });\n                          },\n                        }\n                      ]}\n                    />\n                  </div>\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <div style={{ width: '100%' }}>\n                <IonLabel className='ion-text-wrap uiFont'>更新離線資料</IonLabel>\n                <IonProgressBar value={this.state.dataDownloadRatio} />\n              </div>\n              <IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={async (e) => this.updateData()}>更新</IonButton>\n              <IonToast\n                cssClass='uiFont'\n                isOpen={this.state.showUpdateDataDone}\n                onDidDismiss={() => this.setState({ showUpdateDataDone: false })}\n                message={`離線資料更新完畢！`}\n                duration={2000}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={colorPalette} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings['theme']}</IonLabel>\n              <IonSelect slot='end'\n                value={+this.props.theme}\n                className='uiFont'\n                interface='popover'\n                interfaceOptions={{ cssClass: 'tfwcthemes' }}\n                onIonChange={e => {\n                  const value = +e.detail.value;\n                  // Important! Because it can results in rerendering of this component but\n                  // store states (this.props.theme) of this component is not updated yet! And IonSelect value will be changed\n                  // back to the old value and onIonChange will be triggered again!\n                  // Thus, we use this check to ignore this invalid change.\n                  if (+this.props.theme === value) {\n                    return;\n                  }\n\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'theme',\n                    val: value,\n                  });\n                }}>\n                <IonSelectOption className='uiFont cbeta' value={0}>綠底</IonSelectOption>\n                <IonSelectOption className='uiFont dark' value={1}>暗色</IonSelectOption>\n                <IonSelectOption className='uiFont light' value={2}>亮色</IonSelectOption>\n                <IonSelectOption className='uiFont oldPaper' value={3}>舊書</IonSelectOption>\n                <IonSelectOption className='uiFont marble' value={4}>大理石</IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings['uiFontSize']}: {this.props.uiFontSize}</IonLabel>\n                  <IonRange min={12} max={32} pin={true} snaps={true} value={this.props.uiFontSize} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'uiFontSize',\n                      val: +e.detail.value,\n                    });\n                    setImmediate(() => {\n                      Globals.updateCssVars(this.props.settings);\n                    });\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={helpCircle} slot='start' />\n              <div className='uiFont'>\n                <div>關於</div>\n                <div>作者: Meng-Yuan Huang</div>\n                <div><a href=\"mailto:myh@live.com\" target=\"_new\">myh@live.com</a></div>\n              </div>\n            </IonItem>\n          </IonList>\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage >\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n    hasAppLog: state.settings.hasAppLog,\n    theme: state.settings.theme,\n    uiFontSize: state.settings.uiFontSize,\n    speechRate: state.settings.speechRate,\n    bookmarks: state.settings.bookmarks,\n    voiceURI: state.settings.voiceURI,\n    mainVersion: state.tmpSettings.mainVersion,\n  }\n};\n\nconst SettingsPage = withIonLifeCycle(_SettingsPage);\n\nexport default connect(\n  mapStateToProps,\n)(SettingsPage);\n","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t451,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t452,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t453,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t454,\n\t\t17\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t455,\n\t\t18\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t456,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t457,\n\t\t19\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t458,\n\t\t20\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t459,\n\t\t21\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t460,\n\t\t22\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t461,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t462,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t463,\n\t\t23\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t464,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t465,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t466,\n\t\t24\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t467,\n\t\t25\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t468,\n\t\t26\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t469,\n\t\t27\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t470,\n\t\t28\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t471,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t472,\n\t\t14\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t473,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t474,\n\t\t29\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t475,\n\t\t30\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t476,\n\t\t31\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t477,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t478,\n\t\t16\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t479,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t480,\n\t\t32\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t481,\n\t\t33\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t482,\n\t\t34\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t483,\n\t\t35\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t484,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t485,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t486,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t487,\n\t\t36\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t488,\n\t\t15\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t489,\n\t\t37\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t490,\n\t\t38\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t491,\n\t\t39\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t492,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t493,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 234;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t494,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 236;\nmodule.exports = webpackAsyncContext;","export class Settings {\n    version: number = 1;\n    hasAppLog: boolean = true;\n    theme: number = 2;\n    uiFontSize: number = 24;\n    isInitialized: boolean = false;\n}\n","import Globals from '../../Globals';\nimport { Settings } from '../../models/Settings';\n\nfunction updateUi(newSettings: Settings) {\n  while (document.body.classList.length > 0) {\n    document.body.classList.remove(document.body.classList.item(0)!);\n  }\n  document.body.classList.toggle(`theme${newSettings.theme}`, true);\n  Globals.updateCssVars(newSettings);\n}\n\n// Used to store settings. They will be saved to file.\nexport default function reducer(state = new Settings(), action: any) {\n  var newSettings = { ...state };\n  switch (action.type) {\n    case \"LOAD_SETTINGS\":\n      newSettings = JSON.parse(localStorage.getItem(Globals.storeFile)!).settings;\n      updateUi(newSettings);\n      break;\n    case \"SET_KEY_VAL\":\n      var key = action.key;\n      var val = action.val;\n      switch (key) {\n        case 'theme': {\n          document.body.classList.forEach((val) => {\n            if (/theme/.test(val)) {\n              document.body.classList.remove(val);\n            }\n          });\n          document.body.classList.toggle(`theme${val}`, true);\n          break;\n        }\n      }\n\n      (newSettings as any)[key] = val;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    // @ts-ignore\n    case \"DEFAULT_SETTINGS\":\n      newSettings = new Settings();\n      updateUi(newSettings);\n      break;\n    // eslint-disable-next-line\n    default:\n      if (Object.keys(newSettings).length === 0) {\n        newSettings = new Settings();\n      }\n      const defaultSettings = new Settings();\n      Object.keys(defaultSettings).forEach(key => {\n        if ((newSettings as any)[key] === undefined) {\n          (newSettings as any)[key] = (defaultSettings as any)[key];\n        }\n      });\n  }\n  return newSettings;\n}\n","import { FreeChargingItem } from \"./FreeChargingItem\";\nimport { FreeWifiItem } from \"./FreeWifiItem\";\n\nexport class TmpSettings {\n    fetchError: boolean = false;\n    isLoadingData: boolean = false;\n    freeChargingItems: Array<FreeChargingItem> = [];\n    freeWifiItems: Array<FreeWifiItem> = [];\n    currPosition: GeolocationPosition | undefined = undefined;\n    shareTextModal = { text: '', show: false };\n}\n","import { combineReducers } from \"redux\"\n\nimport settings from \"./setReducer\"\nimport tmpSettings from \"./tmpSetReducer\"\n\nexport default combineReducers({\n  settings, tmpSettings\n})\n","import { TmpSettings } from \"../../models/TmpSettings\";\n\n// Used to store temp settings in RAM. They will not be saved to file.\nexport default function reducer(state = new TmpSettings(), action: any) {\n  var newState = { ...state };\n  var key = action.key;\n  var val = action.val;\n  (newState as any)[key] = val;\n  switch (action.type) {\n    case \"TMP_SET_KEY_VAL\": {\n      return newState;\n    }\n    default:\n      break;\n  }\n  return state;\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonList, IonItem, IonLabel, IonLoading, IonToast, IonTitle, IonInfiniteScroll, IonInfiniteScrollContent, IonAlert } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { location } from 'ionicons/icons';\nimport { FreeChargingItem } from '../models/FreeChargingItem';\nimport { FreeWifiItem } from '../models/FreeWifiItem';\nimport { Settings } from '../models/Settings';\nimport { TmpSettings } from '../models/TmpSettings';\nimport './ListPage.css';\nimport Globals from '../Globals';\n\ninterface Props {\n  dispatch: Function;\n  isLoadingData: boolean;\n  tmpSettings: TmpSettings;\n  settings: Settings;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  path: string;\n  tab: string;\n}> { }\n\ninterface State {\n  dataParts: Array<FreeChargingItem | FreeWifiItem>;\n  popover: any;\n  isScrollOn: boolean;\n  fetchError: boolean;\n  showToast: boolean;\n  toastMessage: string;\n  showConfrimOpenMapAlert: boolean;\n}\n\nclass _ListPage extends React.Component<PageProps, State> {\n  data: Array<FreeChargingItem | FreeWifiItem>;\n  mode: string;\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      dataParts: [],\n      popover: {\n        show: false,\n        event: null,\n      },\n      isScrollOn: false,\n      fetchError: false,\n      showConfrimOpenMapAlert: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.data = [];\n    this.mode = this.props.match.params.tab;\n  }\n\n  ionViewWillEnter() {\n    //console.log(`${this.props.match.url} will enter`);\n    this.fetchData(true);\n  }\n\n  /*\n  componentDidMount() {\n    //console.log(`did mount: ${this.props.match.url}`);\n  }\n  \n  componentWillUnmount() {\n    console.log(`${this.props.match.url} unmount`);\n  }\n\n  ionViewWillLeave() {\n  }\n  */\n\n  page = 0;\n  rows = 20;\n  async fetchData(fromStart: boolean = false) {\n    await new Promise<void>((ok, fail) => {\n      let timer = setInterval(() => {\n        if (!this.props.isLoadingData) {\n          clearInterval(timer);\n          ok();\n        }\n      }, 50);\n    });\n\n    if (fromStart) {\n      if (this.mode !== 'wifi') {\n        this.data = this.props.tmpSettings.freeChargingItems;\n      } else {\n        this.data = this.props.tmpSettings.freeWifiItems;\n      }\n      this.page = 0;\n    }\n\n    //console.log(`Loading page ${this.page}`);\n\n    const dataParts = this.data.slice(this.page * this.rows, (this.page + 1) * this.rows);\n\n    this.page += 1;\n    this.setState({\n      fetchError: false, dataParts: fromStart ? dataParts : [...this.state.dataParts, ...dataParts],\n      isScrollOn: this.state.dataParts.length < this.data.length,\n    });\n\n    return true;\n  }\n\n  selectedMapUrl = '';\n  getRows() {\n    const userCoords = this.props.tmpSettings.currPosition?.coords;\n    let rows = Array<object>();\n    this.state.dataParts.forEach((item: FreeChargingItem | FreeWifiItem, index: number) => {\n      let mapUrl = '';\n      if (userCoords != null) {\n        mapUrl = `https://www.google.com/maps/dir/?api=1&origin=${userCoords.latitude},${userCoords.longitude}&destination=${item.緯度},${item.經度}`;\n      } else {\n        mapUrl = `https://www.google.com/maps/search/?api=1&query=${item.緯度},${item.經度}`;\n      }\n      rows.push(\n        <IonItem button={true} key={`dictItem` + index}\n          onClick={async event => {\n            this.selectedMapUrl = mapUrl;\n            this.setState({ showConfrimOpenMapAlert: true });\n          }}>\n          <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n          <div className='listItem'>\n            <div>\n              <IonLabel className='ion-text-wrap uiFont' key={`bookmarkItemLabel_` + index}>\n                {this.mode !== 'wifi' ? (item as FreeChargingItem).充電站名稱 : (item as FreeWifiItem).熱點名稱}\n              </IonLabel>\n            </div>\n            <div>\n              <IonLabel className='ion-text-wrap uiFontX0_7'>\n                {item.地址}\n              </IonLabel>\n            </div>\n          </div>\n        </IonItem>\n      );\n    });\n    return rows;\n  }\n\n  async getCurrentPositionAndSortData() {\n    this.props.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoadingData',\n      val: true,\n    });\n\n    await Globals.getCurrentPositionAndSortData(\n      this.props.dispatch,\n      this.props.tmpSettings.freeChargingItems,\n      this.props.tmpSettings.freeWifiItems\n    );\n\n    this.props.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoadingData',\n      val: false,\n    });\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'>免費{this.mode !== 'wifi' ? '充電' : ' WiFi'}</IonTitle>\n\n            <IonButton fill=\"clear\" slot='end' onClick={async e => {\n              await this.getCurrentPositionAndSortData()\n              this.fetchData(true);\n            }}>\n              <IonIcon icon={location} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n\n          {\n            !this.props.settings.isInitialized ?\n              <></>\n              :\n              this.props.isLoadingData ?\n                <IonLoading\n                  cssClass='uiFont'\n                  isOpen={this.props.isLoadingData}\n                  message={'載入中...'}\n                />\n                :\n                <IonList>\n                  {this.getRows()}\n                  <IonInfiniteScroll threshold=\"100px\"\n                    disabled={!this.state.isScrollOn}\n                    onIonInfinite={(ev: CustomEvent<void>) => {\n                      this.fetchData();\n                      (ev.target as HTMLIonInfiniteScrollElement).complete();\n                    }}>\n                    <IonInfiniteScrollContent\n                      loadingText=\"載入中...\">\n                    </IonInfiniteScrollContent>\n                  </IonInfiniteScroll>\n                </IonList>\n          }\n\n          <IonAlert\n            cssClass='uiFont'\n            isOpen={this.state.showConfrimOpenMapAlert}\n            backdropDismiss={false}\n            header={'確定開啟地圖？'}\n            buttons={[\n              {\n                text: '關閉',\n                cssClass: 'secondary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showConfrimOpenMapAlert: false,\n                  });\n                },\n              },\n              {\n                text: '確定',\n                cssClass: 'primary uiFont',\n                handler: (value) => {\n                  this.setState({\n                    showConfrimOpenMapAlert: false,\n                  });\n                  window.open(this.selectedMapUrl);\n                },\n              },\n            ]}\n          />\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst ListPage = withIonLifeCycle(_ListPage);\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    isLoadingData: state.tmpSettings.isLoadingData,\n    tmpSettings: state.tmpSettings,\n    settings: state.settings,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(ListPage);\n","import React from 'react';\nimport { IonButton, IonContent, IonItem, IonLabel, IonList, IonModal, IonToggle } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport * as qrcode from 'qrcode';\n\ninterface Props {\n  showModal: boolean;\n  text: string;\n  finish: Function;\n  settings: any;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  isAppSettingsExport: Array<boolean>;\n}\n\nclass _ShareTextModal extends React.Component<PageProps, State> {\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      isAppSettingsExport: Array<boolean>(Object.keys(Globals.appSettings).length)\n    }\n  }\n\n  updateQrCode() {\n    const appSettingsExport = Object.keys(Globals.appSettings).filter((key, i) => this.state.isAppSettingsExport[i]).map((key, i) => { return { key: key, val: this.props.settings[key] }; });\n    let appSettingsString: string | null = appSettingsExport.map(keyVal => `${keyVal.key}=${+keyVal.val}`).join(',');\n    appSettingsString = appSettingsString !== '' ? `settings=${appSettingsString}` : null;\n    let appUrl = this.props.text;\n    const hasQueryString = /\\?/.test(appUrl);\n    if (appSettingsString) {\n      appUrl += hasQueryString ? `&${appSettingsString}` : `?${appSettingsString}`;\n    }\n\n    Globals.copyToClipboard(appUrl);\n    const qrcCanvas = document.getElementById('qrcCanvas');\n    qrcode.toCanvas(qrcCanvas, appUrl);\n    return qrcCanvas;\n  }\n\n  render() {\n    return (\n      <IonModal\n        isOpen={this.props.showModal}\n        cssClass='uiFont'\n        swipeToClose={true}\n        //presentingElement={router || undefined}\n        onWillPresent={() => {\n          let isAppSettingsExport: Array<boolean> = [];\n          for (let i = 0; i < this.state.isAppSettingsExport.length; i++) {\n            isAppSettingsExport.push(false);\n          }\n          this.setState({ isAppSettingsExport: isAppSettingsExport }, () => {\n            this.updateQrCode();\n          });\n        }}\n        onDidDismiss={() => this.props.finish()}>\n        <IonContent>\n          <div style={{ display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center' }}>\n            <div>\n              <IonLabel className='uiFont'>此頁app連結已複製至剪貼簿！</IonLabel>\n            </div>\n            <div>\n              <IonLabel className='uiFont'>也可以使用QR Code分享:</IonLabel>\n            </div>\n            <div style={{ flexGrow: 1, flexShrink: 0, display: 'flex', alignItems: 'center', margin: 10 }}>\n              <canvas id='qrcCanvas' width='500' height='500' style={{ margin: '0px auto' }} />\n            </div>\n            <div>\n              <IonLabel className='uiFont'>包括app設定:</IonLabel>\n              <IonList>\n                {\n                  Object.keys(Globals.appSettings).map((key, i) =>\n                    <IonItem key={`appSettingExportItem_${i}`}>\n                      <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings[key]}</IonLabel>\n                      <IonToggle slot='end' onIonChange={e => {\n                        const isAppSettingsExport = this.state.isAppSettingsExport;\n                        isAppSettingsExport[i] = e.detail.checked;\n                        this.setState({ isAppSettingsExport: isAppSettingsExport }, () => {\n                          this.updateQrCode();\n                        });\n                      }} />\n                    </IonItem>\n                  )\n                }\n              </IonList>\n            </div>\n            <div>\n              <IonButton fill='outline' shape='round' size='large' onClick={() => this.props.finish()}>關閉</IonButton>\n            </div>\n          </div>\n        </IonContent>\n      </IonModal>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(_ShareTextModal);\n","export class FreeChargingItem {\n    主管機關 = ''; // Eg. '內政部'\n    地區 = ''; // Eg. '新北市'\n    充電站名稱 = ''; // Eg. '新北市新店戶政事務所'\n    地址 = ''; // Eg. '231新北市新店區行政街2號2樓'\n    緯度 = 0; // Eg. '24.967241'\n    經度 = 0; // Eg. '121.542046'\n\n    constructor(json: any) {\n        this.主管機關 = json.主管機關;\n        this.地區 = json.地區;\n        this.充電站名稱 = json.充電站名稱;\n        this.地址 = json.地址;\n        this.緯度 = +json.緯度;\n        this.經度 = +json.經度;\n    }\n}\n","export class FreeWifiItem {\n    主管機關 = ''; // Eg. '行政院農業委員會'\n    地區 = ''; // Eg. '臺北市'\n    熱點名稱 = ''; // Eg. '行政院農業委員會10樓辦公區'\n    地址 = ''; // Eg. '100臺北市中正區南海路37號10樓'\n    緯度 = 0; // Eg. '25.0320680'\n    經度 = 0; // Eg. '121.5132000'\n\n    constructor(json: any) {\n        this.主管機關 = json.主管機關;\n        this.地區 = json.地區;\n        this.熱點名稱 = json.熱點名稱;\n        this.地址 = json.地址;\n        this.緯度 = +json.緯度;\n        this.經度 = +json.經度;\n    }\n}\n","import React from 'react';\nimport { Redirect, Route, RouteComponentProps, withRouter } from 'react-router-dom';\nimport {\n  setupConfig,\n  IonApp,\n  IonIcon,\n  IonRouterOutlet,\n  IonTabBar,\n  IonTabButton,\n  IonTabs,\n  IonAlert,\n  isPlatform,\n  IonToast,\n} from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\nimport { connect, Provider } from 'react-redux';\nimport queryString from 'query-string';\nimport getSavedStore from './redux/store';\nimport { settings, batteryCharging, wifi } from 'ionicons/icons';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\nimport SettingsPage from './pages/SettingsPage';\nimport Globals from './Globals';\nimport ListPage from './pages/ListPage';\nimport ShareTextModal from './components/ShareTextModal';\nimport { FreeChargingItem } from './models/FreeChargingItem';\nimport { FreeWifiItem } from './models/FreeWifiItem';\nimport { Settings } from './models/Settings';\nimport { TmpSettings } from './models/TmpSettings';\n\nconst electronBackendApi: any = (window as any).electronBackendApi;\n\nlet store = getSavedStore();\n/*\nclass DebugRouter extends IonReactRouter {\n  constructor(props: any) {\n    super(props);\n    console.log('initial history is: ', JSON.stringify(this.history, null, 2))\n    this.history.listen((location, action) => {\n      console.log(\n        `The current URL is ${location.pathname}${location.search}${location.hash}`\n      )\n      console.log(`The last navigation action was ${action}`, JSON.stringify(this.history, null, 2));\n    });\n  }\n}\n*/\n\nsetupConfig({\n  mode: 'md', // Use a consistent UI style across Android and iOS.\n  swipeBackEnabled: false,\n});\n\nexport var serviceWorkCallbacks = {\n  onSuccess: function (registration: ServiceWorkerRegistration) { },\n  onUpdate: function (registration: ServiceWorkerRegistration) { },\n};\n\ninterface Props {\n  dispatch: Function;\n  shareTextModal: any;\n  settings: Settings;\n  tmpSettings: TmpSettings;\n}\n\ninterface PageProps extends RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface AppOrigProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  showToast: boolean;\n  toastMessage: string;\n  showUpdateAlert: boolean;\n  showGetPositionAlert: boolean;\n  showRestoreAppSettingsToast: boolean;\n}\n\nclass _App extends React.Component<PageProps> {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppOrig {...this.props} />\n      </Provider>\n    );\n  }\n}\n\nclass _AppOrig extends React.Component<AppOrigProps, State> {\n  registrationNew: ServiceWorkerRegistration | null;\n  originalAppSettingsStr: string | null | undefined;\n\n  constructor(props: any) {\n    super(props);\n    if (!this.props.settings.hasAppLog) {\n      Globals.disableAppLog();\n    }\n\n    electronBackendApi?.receive(\"fromMain\", (data: any) => {\n      switch (data.event) {\n        case 'version':\n          store.dispatch({\n            type: \"TMP_SET_KEY_VAL\",\n            key: 'mainVersion',\n            val: data.version,\n          });\n          break;\n      }\n    });\n    electronBackendApi?.send(\"toMain\", { event: 'ready' });\n\n    this.registrationNew = null;\n    // Disable browser callout.\n    if (isPlatform('android')) {\n      window.oncontextmenu = Globals.disableAndroidChromeCallout;\n    } else if (isPlatform('ios')) {\n      document.ontouchend = Globals.disableIosSafariCallout.bind(window);\n    }\n\n    // ----- Initializing UI settings -----\n    // Apply the theme setting.\n    while (document.body.classList.length > 0) {\n      document.body.classList.remove(document.body.classList.item(0)!);\n    }\n    document.body.classList.toggle(`theme${this.props.settings.theme}`, true);\n\n    // Modify UI settings from query string.\n    const queryParams = queryString.parse(this.props.location.search) as any;\n    if (queryParams.settings) {\n      this.originalAppSettingsStr = localStorage.getItem(Globals.storeFile);\n      (queryParams.settings as string).split(',').forEach(setting => {\n        const keyVal = setting.split('=');\n        this.props.dispatch({\n          type: \"SET_KEY_VAL\",\n          key: keyVal[0],\n          val: +keyVal[1],\n        });\n      });\n    }\n    Globals.updateCssVars(this.props.settings);\n\n    this.state = {\n      showUpdateAlert: false,\n      showRestoreAppSettingsToast: (queryParams.settings != null && this.originalAppSettingsStr != null) || false,\n      showToast: false,\n      showGetPositionAlert: false,\n      toastMessage: '',\n    };\n\n    serviceWorkCallbacks.onUpdate = (registration: ServiceWorkerRegistration) => {\n      this.registrationNew = registration;\n      this.setState({ showUpdateAlert: true });\n    };\n\n    serviceWorkCallbacks.onSuccess = (registration: ServiceWorkerRegistration) => {\n    };\n\n    // Preload speechSynthesis.\n    if (typeof speechSynthesis !== 'undefined') {\n      speechSynthesis.getVoices();\n      speechSynthesis.cancel();\n    }\n\n    // Enable screen wake lock.\n    if ((navigator as any).wakeLock) {\n      this.wakeLockScreen();\n      document.addEventListener(\"visibilitychange\", async () => {\n        if (document.visibilityState === 'visible') {\n          this.wakeLockScreen();\n        } else {\n          this.wakeLockScreenRelease()\n        }\n      });\n    }\n\n    const dbOpenReq = indexedDB.open(Globals.tfwcDb);\n    // Init store in indexedDB if necessary.\n    dbOpenReq.onupgradeneeded = function (event: IDBVersionChangeEvent) {\n      var db = (event.target as any).result;\n      db.createObjectStore('store');\n      console.log(`DB store created.`);\n    };\n    this.loadTwdData();\n  }\n\n  restoreAppSettings() {\n    localStorage.setItem(Globals.storeFile, this.originalAppSettingsStr!);\n    this.props.dispatch({ type: 'LOAD_SETTINGS' });\n  }\n\n  async loadTwdData() {\n    store.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoadingData',\n      val: true,\n    });\n    let data: any[];\n    for (let i = 0; i < Globals.freeResources.length; i++) {\n      let item = Globals.freeResources[i];\n      try {\n        data = await Globals.getFileFromIndexedDB(item.dataKey) as any[];\n      } catch (err) {\n        data = await Globals.downloadCsvZipData(item.url, (progress: number) => {\n        });\n        Globals.saveFileToIndexedDB(item.dataKey, data);\n      }\n\n      if (i === 0) {\n        store.dispatch({\n          type: \"TMP_SET_KEY_VAL\",\n          key: 'freeChargingItems',\n          val: data.map(d => new FreeChargingItem(d)),\n        });\n      } else {\n        store.dispatch({\n          type: \"TMP_SET_KEY_VAL\",\n          key: 'freeWifiItems',\n          val: data.map(d => new FreeWifiItem(d)),\n        });\n      }\n    }\n\n    if (!this.props.settings.isInitialized) {\n      this.setState({ showGetPositionAlert: true });\n    } else {\n      this.getCurrentPositionAndSortData();\n    }\n  }\n\n  // Prevent device from sleeping.\n  wakeLock: any;\n  async wakeLockScreen() {\n    try {\n      const wakeLock = (navigator as any).wakeLock;\n      if (wakeLock != null) {\n        this.wakeLock = await wakeLock.request('screen');\n        console.log('Screen wake lock is requested.');\n      } else {\n        console.error('navigator.wakeLock is undefined.');\n      }\n    } catch (err: any) {\n      // the wake lock request fails - usually system related, such low as battery\n      console.log(`${err.name}, ${err.message}`);\n      console.log(new Error().stack);\n    }\n  }\n\n  async wakeLockScreenRelease() {\n    if (this.wakeLock != null) {\n      await this.wakeLock.release();\n      this.wakeLock = null;\n      console.log('Screen wake lock is released.');\n    }\n  }\n\n  routeByQueryString() {\n    // This app uses client side routing. \n    // Without the first loading of this app,\n    // any client side route becomes a server side route!\n    // These invalid server side routings cause 404 errors.\n    // To workaround these errors, we can use GitHub 404.html redirection\n    // to pass the client side routes to this app by using query string.\n    // After this app loads, it can use the query string to correctly redirect to\n    // a client side route!\n    console.log(window.location.search);\n    const routeMatches = /route=([^&]*)/.exec(window.location.search);\n    const queryMatches = /query=([^&]*)/.exec(window.location.search);\n    if (routeMatches !== null) {\n      const route = decodeURIComponent(routeMatches[1]);\n\n      let query = ''\n      if (queryMatches !== null) {\n        query = decodeURIComponent(queryMatches[1]);\n      }\n      return <Redirect to={`${Globals.pwaUrl}` + route + query} />;\n    } else if (window.location.pathname === `${Globals.pwaUrl}/` || window.location.pathname === `${Globals.pwaUrl}`) {\n      return <Redirect to={`${Globals.pwaUrl}/charging`} />;\n    }\n  }\n\n  async getCurrentPositionAndSortData() {\n    await Globals.getCurrentPositionAndSortData(\n      store.dispatch,\n      this.props.tmpSettings.freeChargingItems,\n      this.props.tmpSettings.freeWifiItems\n    );\n\n    store.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoadingData',\n      val: false,\n    });\n  }\n\n  render() {\n    return (\n      <IonApp>\n        <IonReactRouter>\n          <IonTabs>\n            <IonRouterOutlet animated={false}>\n              {/* The following route is for backward compatibility. */}\n              <Route path={`${Globals.pwaUrl}/:tab(charging)`} render={(props: any) => <ListPage {...props} />} exact={true} />\n              <Route path={`${Globals.pwaUrl}/:tab(wifi)`} render={(props: any) => <ListPage {...props} />} exact={true} />\n              <Route path={`${Globals.pwaUrl}/settings`} render={(props: any) => <SettingsPage {...props} />} />\n              <Route path={`${Globals.pwaUrl}/`} render={() => { return this.routeByQueryString(); }} exact={true} />\n            </IonRouterOutlet>\n            <IonTabBar slot=\"bottom\">\n              <IonTabButton tab=\"charging\" href={`${Globals.pwaUrl}/charging`}>\n                <IonIcon icon={batteryCharging} />\n              </IonTabButton>\n              <IonTabButton tab=\"wifi\" href={`${Globals.pwaUrl}/wifi`}>\n                <IonIcon icon={wifi} />\n              </IonTabButton>\n              <IonTabButton tab=\"settings\" href={`${Globals.pwaUrl}/settings`}>\n                <IonIcon icon={settings} />\n              </IonTabButton>\n            </IonTabBar>\n          </IonTabs>\n        </IonReactRouter>\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showUpdateAlert}\n          backdropDismiss={false}\n          onDidPresent={(ev) => {\n            // Run SKIP_WAITING at onDidPresent event to avoid a race condition of\n            // an old page fetching old JS chunks with a new service worker!\n            this.registrationNew?.installing?.postMessage({ type: 'SKIP_WAITING' });\n            this.registrationNew?.waiting?.postMessage({ type: 'SKIP_WAITING' });\n          }}\n          header={'App 已更新，請重啟!'}\n          buttons={[\n            {\n              text: '關閉',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showUpdateAlert: false,\n                });\n              },\n            }\n          ]}\n        />\n\n        <ShareTextModal\n          {...{\n            text: this.props.shareTextModal?.text,\n            showModal: this.props.shareTextModal?.show || false,\n            finish: () => {\n              store.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: { show: false },\n              });\n            }, ...this.props\n          }}\n        />\n\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showGetPositionAlert}\n          backdropDismiss={false}\n          header={'需要您的位置作導航至免費充電站或 WiFi 熱點。按下關閉後，會跳出位置權限存取，請允許此 app 存取您的位置。'}\n          buttons={[\n            {\n              text: '關閉',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showGetPositionAlert: false,\n                });\n                store.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'isInitialized',\n                  val: true,\n                });\n                this.getCurrentPositionAndSortData();\n              },\n            },\n          ]}\n        />\n\n        <IonToast\n          cssClass='uiFont'\n          isOpen={this.state.showRestoreAppSettingsToast}\n          onDidDismiss={() => this.setState({ showRestoreAppSettingsToast: false })}\n          message={`已套用app連結中的設定，是否還原設定？`}\n          buttons={[\n            {\n              text: '取消',\n              role: 'cancel',\n              handler: () => this.setState({ showRestoreAppSettingsToast: false })\n            },\n            {\n              text: '還原',\n              handler: () => this.restoreAppSettings(),\n            },\n          ]}\n        />\n\n        <IonToast\n          cssClass='uiFont'\n          isOpen={this.state.showToast}\n          onDidDismiss={() => this.setState({ showToast: false })}\n          message={this.state.toastMessage}\n          duration={2000}\n        />\n      </IonApp>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    shareTextModal: state.tmpSettings.shareTextModal,\n    settings: state.settings,\n    tmpSettings: state.tmpSettings,\n  }\n};\n\nconst AppOrig = connect(\n  mapStateToProps,\n)(_AppOrig);\n\n\nconst App = withRouter(_App);\n\nexport default App;\n","import { /*applyMiddleware,*/ createStore, Store } from \"redux\";\n\n//import { logger } from \"redux-logger\"\n//import thunk from \"redux-thunk\"\n//import promise from \"redux-promise-middleware\"\n\nimport reducer from \"./reducers\";\nimport Globals from \"../Globals\";\n\n//const middleware = applyMiddleware(promise(), thunk, logger)\n\nvar savedStore: Store;\n\nexport default function getSavedStore() {\n    var savedSettingsStr = localStorage.getItem(Globals.storeFile);\n    if (savedSettingsStr != null) {\n        savedStore = createStore(reducer, JSON.parse(savedSettingsStr));//, middleware)\n    }\n    else {\n        savedStore = createStore(reducer);//, middleware)\n    }\n\n    return savedStore;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      /*\n      if(registration.waiting) {\n        const reg = registration.waiting;\n        reg.postMessage({ type: 'SKIP_WAITING' });\n        alert('Skip waiting.');\n      }*/\n\n      registration.onupdatefound = () => {\n        //alert('onupdatefound.');\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          console.log(`installingWorker stage changed: ${installingWorker.state}`);\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from \"react-router-dom\";\nimport App, {serviceWorkCallbacks} from './App';\nimport Globals from './Globals';\nimport * as serviceWorker from './serviceWorkerRegistration';\n\n// Enable at the very start for logging most messages.\nGlobals.enableAppLog();\n\nReactDOM.render(<BrowserRouter><App /></BrowserRouter>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register({\n    onSuccess: (registration: ServiceWorkerRegistration) => { console.log('Precache app loaded!'); serviceWorkCallbacks.onSuccess(registration); },\n    onUpdate: (registration: ServiceWorkerRegistration) => { console.log('Found app updated!'); serviceWorkCallbacks.onUpdate(registration); },\n});\n","import { isPlatform, IonLabel } from '@ionic/react';\nimport fs from 'fs';\nimport AdmZip from 'adm-zip';\nimport parse from 'csv-parse/lib/sync';\nimport { DownloaderHelper, Stats } from 'node-downloader-helper';\nimport { FreeWifiItem } from './models/FreeWifiItem';\nimport { FreeChargingItem } from './models/FreeChargingItem';\n\nconst pwaUrl = process.env.PUBLIC_URL || '';\nconst bugReportApiUrl = 'https://vh6ud1o56g.execute-api.ap-northeast-1.amazonaws.com/bugReportMailer';\nlet freeChargingUrl = `https://d23fxcqevt3np7.cloudfront.net/charge_station_list.zip`;\nlet freeWifiUrl = `https://d23fxcqevt3np7.cloudfront.net/hotspotlist.zip`;\n\nconst tfwcDb = 'tfwcDb';\nconst freeChargingDataKey = 'freeCharging';\nconst freeWifiDataKey = 'freeWifi';\nlet log = '';\n\nasync function downloadCsvZipData(url: string, progressCallback: Function) {\n  let dataBuffer = await downloadData(url, progressCallback);\n  const zip = new AdmZip(dataBuffer);\n  let dataStr = zip.getEntries()[0].getData().toString('utf8');\n  return parse(dataStr, {\n    columns: true,\n    bom: dataStr.charCodeAt(0) === 0xFEFF,\n  });\n}\n\nasync function downloadData(url: string, progressCallback: Function) {\n  return new Promise<Buffer>((ok, fail) => {\n    const dl = new DownloaderHelper(url, '.', {});\n    let progressUpdateEnable = true;\n    dl.on('progress', (stats: Stats) => {\n      if (progressUpdateEnable) {\n        // Reduce number of this calls by progressUpdateEnable.\n        // Too many of this calls could result in 'end' event callback is executed before 'progress' event callbacks!\n        progressCallback(stats.progress);\n        progressUpdateEnable = false;\n        setTimeout(() => {\n          progressUpdateEnable = true;\n        }, 100);\n      }\n    });\n    dl.on('end', (downloadInfo: any) => {\n      dl.removeAllListeners();\n      ok(fs.readFileSync(downloadInfo.filePath));\n    });\n    dl.start();\n  });\n}\n\nasync function getFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(tfwcDb);\n\n  return new Promise(function (ok, fail) {\n    dbOpenReq.onsuccess = async function (ev) {\n      const db = dbOpenReq.result;\n\n      try {\n        const trans = db.transaction([\"store\"], 'readwrite');\n        let req = trans.objectStore('store').get(fileName);\n        req.onsuccess = async function (_ev) {\n          const data = req.result;\n          if (!data) {\n            console.error(`${fileName} loading failed!`);\n            console.error(new Error().stack);\n            return fail();\n          }\n          return ok(data);\n        };\n      } catch (err) {\n        console.error(err);\n      }\n    };\n  });\n}\n\nasync function saveFileToIndexedDB(fileName: string, data: any) {\n  const dbOpenReq = indexedDB.open(tfwcDb);\n  return new Promise<void>((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').put(data, fileName);\n      reqWrite.onsuccess = (_ev: any) => ok();\n      reqWrite.onerror = (_ev: any) => fail();\n    };\n  });\n}\n\nasync function removeFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(tfwcDb);\n  return new Promise<void>((ok, fail) => {\n    try {\n      dbOpenReq.onsuccess = (ev: Event) => {\n        const db = dbOpenReq.result;\n\n        const transWrite = db.transaction([\"store\"], 'readwrite')\n        try {\n          const reqWrite = transWrite.objectStore('store').delete(fileName);\n          reqWrite.onsuccess = (_ev: any) => ok();\n          reqWrite.onerror = (_ev: any) => fail();\n        } catch (err) {\n          console.error(err);\n        }\n      };\n    } catch (err) {\n      fail(err);\n    }\n  });\n}\n\nasync function clearIndexedDB() {\n  const dbOpenReq = indexedDB.open(tfwcDb);\n  return new Promise<void>((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').clear();\n      reqWrite.onsuccess = (_ev: any) => ok();\n      reqWrite.onerror = (_ev: any) => fail();\n    };\n  });\n}\n\nasync function clearAppData() {\n  localStorage.clear();\n  await clearIndexedDB();\n}\n\nasync function getCurrentPosition() {\n  return new Promise<GeolocationPosition>((ok, fail) => {\n    if (!navigator.geolocation) {\n      fail('No geolocation object!');\n    } else {\n      navigator.geolocation.getCurrentPosition((position: GeolocationPosition) => {\n        ok(position);\n      }, (error: GeolocationPositionError) => {\n        fail(`${error.code}: ${error.message}`);\n      });\n    }\n  });\n}\n\nfunction distance(item: FreeChargingItem | FreeWifiItem, coords: GeolocationCoordinates) {\n  return Math.sqrt((item.經度 - coords.longitude)**2 + (item.緯度 - coords.latitude)**2)\n}\n\nasync function getCurrentPositionAndSortData(dispatch: Function, freeChargingItems: Array<FreeChargingItem>, freeWifiItems: Array<FreeWifiItem>) {\n  try {\n    const postiion = await getCurrentPosition();\n    const userCoords = postiion.coords;\n    dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'currPosition',\n      val: postiion,\n    });\n    dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'freeChargingItems',\n      val: freeChargingItems.sort((a, b) => distance(a, userCoords) - distance(b, userCoords)),\n    });\n    dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'freeWifiItems',\n      val: freeWifiItems.sort((a, b) => distance(a, userCoords) - distance(b, userCoords)),\n    });\n  } catch (error) {\n    console.error(error);\n  }\n}\n\n//const electronBackendApi: any = (window as any).electronBackendApi;\n\nfunction removeElementsByClassName(doc: Document, className: string) {\n  let elements = doc.getElementsByClassName(className);\n  while (elements.length > 0) {\n    elements[0].parentNode?.removeChild(elements[0]);\n  }\n}\n\nconst consoleLog = console.log.bind(console);\nconst consoleError = console.error.bind(console);\n\nfunction getLog() {\n  return log;\n}\n\nfunction enableAppLog() {\n  console.log = function () {\n    log += '----- Info ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleLog.apply(console, arguments as any);\n  };\n\n  console.error = function () {\n    log += '----- Error ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleError.apply(console, arguments as any);\n  };\n}\n\nfunction disableAppLog() {\n  log = '';\n  console.log = consoleLog;\n  console.error = consoleError;\n}\n\nfunction disableAndroidChromeCallout(event: any) {\n  event.preventDefault();\n  event.stopPropagation();\n  return false;\n}\n\n// Workable but imperfect.\nfunction disableIosSafariCallout(this: Window, event: any) {\n  const s = this.getSelection();\n  if ((s?.rangeCount || 0) > 0) {\n    const r = s?.getRangeAt(0);\n    s?.removeAllRanges();\n    setTimeout(() => {\n      s?.addRange(r!);\n    }, 50);\n  }\n}\n\n//const webkit = (window as any).webkit;\nfunction copyToClipboard(text: string) {\n  try {\n    navigator.clipboard && navigator.clipboard.writeText(text);\n  } catch (error) {\n    console.error(error);\n  }\n}\n\nfunction isMacCatalyst() {\n  return isPlatform('ios') && navigator.platform === 'MacIntel';\n}\n\nconst Globals = {\n  pwaUrl,\n  bugReportApiUrl,\n  storeFile: 'tfwcSettings.json',\n  downloadCsvZipData,\n  getCurrentPosition,\n  getCurrentPositionAndSortData,\n  getLog,\n  enableAppLog,\n  disableAppLog,\n  tfwcDb,\n  freeResources: [\n    { item: \"離線免費充電資料\", dataKey: freeChargingDataKey, url: freeChargingUrl },\n    { item: \"離線免費 WiFi 資料\", dataKey: freeWifiDataKey, url: freeWifiUrl },\n  ],\n  appSettings: {\n    'theme': '佈景主題',\n    'uiFontSize': 'UI 字型大小',\n  } as Record<string, string>,\n  fetchErrorContent: (\n    <div className='contentCenter'>\n      <IonLabel>\n        <div>\n          <div>連線失敗!</div>\n          <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24 }}>如果問題持續發生，請執行<a href={`/${pwaUrl}/settings`} target=\"_self\">設定頁</a>的 app 異常回報功能。</div>\n        </div>\n      </IonLabel>\n    </div>\n  ),\n  updateApp: () => {\n    return new Promise(async resolve => {\n      navigator.serviceWorker.getRegistrations().then(async regs => {\n        const hasUpdates = await Promise.all(regs.map(reg => (reg.update() as any).then((newReg: ServiceWorkerRegistration) => {\n          return newReg.installing !== null || newReg.waiting !== null;\n        })));\n        resolve(hasUpdates.reduce((prev, curr) => prev || curr, false));\n      });\n    });\n  },\n  updateCssVars: (settings: any) => {\n    document.documentElement.style.cssText = `--ui-font-size: ${settings.uiFontSize}px;`\n  },\n  isMacCatalyst,\n  isTouchDevice: () => {\n    return (isPlatform('ios') && !isMacCatalyst()) || isPlatform('android');\n  },\n  isStoreApps: () => {\n    return isPlatform('pwa') || isPlatform('electron');\n  },\n  getFileFromIndexedDB,\n  saveFileToIndexedDB,\n  removeFileFromIndexedDB,\n  clearAppData,\n  removeElementsByClassName,\n  disableAndroidChromeCallout,\n  disableIosSafariCallout,\n  copyToClipboard,\n};\n\nexport default Globals;\n"],"sourceRoot":""}